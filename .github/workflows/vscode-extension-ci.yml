name: "VSCode Extension - CI"

on:
  push:
    branches:
      - task/extension/branch-preview

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20.x

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.x

    - name: Install dependencies
      run: npm i -g typescript @vscode/vsce

    - name: Install Visual Studio Code
      run: |
        Invoke-WebRequest -Uri "https://update.code.visualstudio.com/latest/win32-x64/stable" -OutFile "VSCodeSetup.exe"
        Start-Process -FilePath "VSCodeSetup.exe" -ArgumentList "/VERYSILENT", "/NORESTART" -Wait
        $env:PATH += ";C:\Program Files\Microsoft VS Code\bin"

    - name: Run PowerShell script
      run: |
        pwsh -File ./scripts/execute-vscode-sideload.ps1

    # - name: Create Codespace
    #   uses: codespaces/create-codespace@v1
    #   with:
    #     repository: ${{ github.repository }}
    #     ref: ${{ github.head_ref }}
    #     devcontainer_path: .devcontainer/devcontainer.json
